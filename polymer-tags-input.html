<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-a11y-keys/iron-a11y-keys.html">
<link ref="import" href="../polymer-keydown/polymer-keydown.html"
<!--
`polymer-tags-input`
an input especially for tags

@demo demo/index.html 
-->

<dom-module id="polymer-tags-input">
    <template>
        <style>
            :host {
                display: block;
                padding: 4px;
            }

            .tag {
                background-color: cornflowerblue;
                border-color: black;
                padding: 2px 4px;
                margin-right: 4px;
                color: white;
            }

            #input {
                width: auto;
                display: inline-block;
            }
        </style>

        <iron-a11y-keys id="a11y" target="[[target]]"
                        keys="[[delimiter]]"
                        stop-keyboard-event-propagation="true"
                        on-keys-pressed="_add"></iron-a11y-keys>

        <polymer-keydown code="8" on-keydown="_deleteLast" />

        <div on-tap="_focus">
            <template is="dom-repeat" items="{{tags}}" as="tag">

        <span class="tag">
          {{tag}}
          <iron-icon icon="clear" on-tap="_delete"></iron-icon>
            </span>
            </template>
            <div id="input" contenteditable="true"></div>
        </div>

    </template>

    <script>
        Polymer( {

            is: 'polymer-tags-input',

            properties: {
                tags: {
                    type  : Array,
                    notify: true,
                    value : ["test"]
                },

                delimiter: {
                    type : String,
                    value: ","
                }
            },

            _delete: function( evt ){
                console.log( "delete", evt );
                this.splice( 'tags', evt.model.index, 1 );
            },

            _focus: function( evt ){
                console.log( "on tap", evt );
                this.$.input.focus();
            },

            _deleteLast: function(evt){
              console.log("keypress", evt);
                if(event.keyCode == 8 && !this.$.input.innerText){
                     this.pop('tags');
                }
            },

            _add: function( evt, detail ){
                console.log( "add", evt );

                detail.keyboardEvent.preventDefault();

                var newTag = this.$.input.innerText.replace( this.delimiter, "" ).toLowerCase();
                console.log( "newtag", newTag );
                if( newTag && this.tags.indexOf( newTag ) == -1 ) this.push( 'tags', newTag );
                this.$.input.innerText = "";
            },


        } );
    </script>
</dom-module>
